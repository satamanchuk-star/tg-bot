# Техническое задание

## Интеллектуальный модуль Telegram-бота ЖК

## 1. Цель проекта

Создать модуль ИИ, который:

1. Строго и точно выявляет мат и грубость.
2. Поддерживает дружелюбную атмосферу.
3. Общается с пользователями в живом, заинтересованном стиле.
4. Формирует ежедневную сводку по всем чатам.
5. Работает предсказуемо, безопасно и управляемо.

## 2. Общие принципы

- Язык: русский.
- Ответы краткие.
- Стиль: лёгкий, заинтересованный, с аккуратным нейтральным юмором.
- Без токсичности, сарказма и фамильярности.
- ИИ не принимает финальные санкции — решение применяет бот по правилам.

## 3. Режимы работы

### 3.1 Модерация

ИИ анализирует входящие сообщения и возвращает:

- тип нарушения,
- степень (0–3),
- уверенность,
- рекомендованное действие.

### 3.2 Ассистент

ИИ отвечает:

- по вопросам ЖК,
- по нейтральным бытовым темам,
- по запросу (команда / упоминание / reply).

ИИ не отвечает без триггера.

### 3.3 Ежедневная сводка

Раз в сутки формируется отчёт по активности всех чатов.

## 4. Политика модерации

### 4.1 Что считается матом

Распознаётся:

- прямой мат,
- производные,
- склонения,
- замаскированные формы:
  - символы (`*`, `_`, `.`, `-`),
  - пробелы,
  - латиница,
  - цифры,
  - транслитерация,
  - замены «ё/е», «й/и»,
  - частично скрытые слова.

Замаскированный мат считается нарушением.

### 4.2 Что считается грубостью

- прямые оскорбления,
- унижение личности,
- агрессивные команды,
- токсичное поведение,
- пассивная агрессия.

### 4.3 Уровни нарушения

| Уровень | Описание |
| --- | --- |
| 0 | Нет нарушения |
| 1 | Мягкая грубость |
| 2 | Явное нарушение |
| 3 | Серьёзное нарушение |

## 5. Матрица действий

| Severity | Действие |
| --- | --- |
| 0 | Нет действия |
| 1 | Предупреждение |
| 2 | Удаление + предупреждение |
| 3 | Удаление + страйк |

### 5.1 Эскалация

- 1 страйк — фиксация.
- 2 страйка за 24ч — авто-мут (если включён).
- 3 страйка за 7 дней — рекомендация мута.
- 5 страйков за 30 дней — рекомендация бана.

Страйки очищаются через 30 дней.

### 5.2 Повторные нарушения подряд

2 сообщения подряд с severity ≥ 2 → усиление реакции + уведомление админов.

## 6. Апелляция

Администратор может:

- отменить удаление,
- снять страйк,
- отметить ложное срабатывание,
- скорректировать строгость в конкретном чате.

Все отмены логируются.

## 7. Границы ассистента

### 7.1 Разрешено

- темы ЖК,
- инфраструктура,
- бытовые вопросы,
- нейтральный small talk.

### 7.2 Запрещено

- политика,
- религия,
- национальные конфликты,
- медицинские назначения,
- юридические консультации,
- финансовые советы,
- персональные данные.

### 7.3 Ограничения ответа

- до 800 символов,
- без таблиц,
- без длинных монологов,
- при отказе — вежливый короткий ответ.

## 8. Ежедневная сводка

### 8.1 Периодичность

- 1 раз в сутки,
- время настраивается,
- единый часовой пояс.

### 8.2 Метрики сводки

- количество сообщений,
- активные участники (≥ 2 сообщений),
- предупреждения,
- удаления,
- страйки,
- конфликты,
- основные темы,
- позитивный элемент,
- краткое настроение дня.

### 8.3 Определение конфликта

- ≥ 3 сообщений подряд severity ≥ 2,
- либо ≥ 2 пользователей с severity ≥ 2 в одном обсуждении.

### 8.4 Отказ отправки

- 3 попытки повторной отправки,
- при сбое — уведомление админов.

## 9. Контекст и приватность

### 9.1 Контекст модели

- до 20 последних сообщений,
- без вложений,
- без пересылки персональных данных.

### 9.2 Хранение логов

- 90 дней,
- доступ только администраторам,
- в сводке не публикуются нарушители.

### 9.3 Маскирование

- телефоны скрываются,
- email скрываются,
- ФИО сокращаются.

## 10. Надёжность API

- Таймаут 20 секунд.
- До 2 повторов при 5xx.
- При недоступности:
  - используется локальный фильтр,
  - автоматических санкций severity 2 не применяется,
  - админы уведомляются.

### 10.1 Ограничение затрат

- дневной лимит запросов,
- лимит токенов,
- при превышении отключается ассистент,
- модерация остаётся.

## 11. Метрики качества

### 11.1 Модерация

- Precision ≥ 90%
- Recall ≥ 85%
- Ложные срабатывания ≤ 5%

### 11.2 Ассистент

- Среднее время ответа ≤ 2 сек
- Нет токсичных ответов
- Доля некорректных отказов ≤ 10%

### 11.3 Сводка

- 99% отправок вовремя
- Нет утечки персональных данных

## 12. План запуска

1. Shadow-режим (7 дней) — только классификация.
2. Предупреждения без удаления (5 дней).
3. Полный режим после анализа метрик.

## 13. Безопасность

- API-ключ хранится в Git Secret `AI_KEY`.
- Не логируется.
- Не передаётся в ответы.
- Не хранится в коде.

## 14. Артефакты перед разработкой

Обязательные документы:

1. Политика модерации.
2. Политика ассистента.
3. Спецификация сводки.
4. Тестовый набор для оценки качества.

## Итог

После реализации:

- Мат (включая замаскированный) выявляется стабильно.
- Конфликтность в чатах снижается.
- Бот воспринимается как помощник.
- Администраторы получают прозрачную аналитику.
- Система работает безопасно и управляемо.
